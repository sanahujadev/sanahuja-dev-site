---
import diplomas from '../../data/diplomas.json';
import OptimizedLazyImage from '../OptimizedLazyImage.astro';

const { categories } = Astro.props;
---

<div class="mt-8">
    <div class="flex justify-center flex-wrap gap-4 mb-8">
        <button data-filter="all" class="filter-btn active px-4 py-2 rounded-md bg-primary text-white">{categories.all}</button>
        {Object.entries(categories).map(([key, value]) => {
            if (key !== 'all') {
                return <button data-filter={key} class="cursor-pointer filter-btn px-4 py-2 rounded-md bg-bg-surface dark:bg-bg-surface-dark border border-border-default dark:border-border-default-dark text-text-muted-dark">{value}</button>
            }
        })}
    </div>

    <div class="max-h-[800px] overflow-y-auto pr-4 custom-scrollbar">
        <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {diplomas.map(diploma => (
                <a href={diploma.pdfUrl} target="_blank" rel="noopener noreferrer" class="gallery-item block border border-border-default dark:border-border-default-dark rounded-lg overflow-hidden transition hover:scale-105" data-category={diploma.category}>
                    <OptimizedLazyImage src={diploma.thumbnailBaseUrl} alt={diploma.title} class="w-full h-auto object-cover"/>
                    <p class="p-2 text-sm text-center bg-bg-surface dark:bg-bg-surface-dark">{diploma.title}</p>
                </a>
            ))}
        </div>
    </div>
</div>

<style>
    .gallery-item.hidden {
        display: none;
    }
    .filter-btn.active {
        background-color: var(--color-primary);
        color: white;
    }
    .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: var(--color-primary);
        border-radius: 10px;
    }
</style>

<script>
    const filterBtns = document.querySelectorAll('.filter-btn');
    const galleryItems = document.querySelectorAll('.gallery-item');

    filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            filterBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const filter = btn.getAttribute('data-filter');

            galleryItems.forEach(item => {
                if (filter === 'all' || item.getAttribute('data-category') === filter) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        });
    });
</script>